

###  ä¸€ç»´æƒ…å†µæŽ¨å¯¼

1. **å¡«å……åŽçš„æ€»é•¿åº¦**ï¼š  
   \[
   L_{\text{padded}} = L_{\text{in}} + 2P
   \]

2. **ç¬¬ä¸€æ¬¡æ”¾ç½®**ï¼šå·ç§¯æ ¸è¦†ç›–ä½ç½® \( [0, K-1] \)

3. **æœ€åŽä¸€æ¬¡æ”¾ç½®**ï¼šå·ç§¯æ ¸å³è¾¹ç•Œä¸èƒ½è¶…è¿‡ \( L_{\text{padded}} - 1 \)  
   è®¾å…±æ”¾ç½® \( N \) æ¬¡ï¼Œåˆ™æœ€åŽä¸€æ¬¡çš„èµ·å§‹ä½ç½®ä¸º \( (N-1) \times S \)  
   è¦æ±‚ï¼š
   \[
   (N-1) \cdot S + (K - 1) \leq L_{\text{padded}} - 1
   \]

4. **è§£ä¸ç­‰å¼**ï¼š
   \[
   (N-1) \cdot S \leq L_{\text{padded}} - K
   \]
   \[
   N - 1 \leq \frac{L_{\text{padded}} - K}{S}
   \]
   \[
   N \leq \frac{L_{\text{padded}} - K}{S} + 1
   \]

5. **å–æœ€å¤§æ•´æ•°**ï¼ˆå› ä¸ºä¸èƒ½æ”¾åŠä¸ªæ ¸ï¼‰ï¼š
   \[
   N = \left\lfloor \frac{L_{\text{in}} + 2P - K}{S} \right\rfloor + 1
   \]

âœ… è¿™å°±æ˜¯**ä¸€ç»´å·ç§¯è¾“å‡ºé•¿åº¦å…¬å¼**ã€‚

---

### ðŸ“ ä¸‰ã€æ‰©å±•åˆ°äºŒç»´ï¼ˆå›¾åƒï¼‰

å›¾åƒæœ‰é«˜ï¼ˆHï¼‰å’Œå®½ï¼ˆWï¼‰ï¼Œä½†å·ç§¯åœ¨ä¸¤ä¸ªæ–¹å‘ç‹¬ç«‹æ“ä½œï¼Œæ‰€ä»¥ï¼š

\[
H_{\text{out}} = \left\lfloor \frac{H_{\text{in}} + 2P_H - K_H}{S_H} \right\rfloor + 1
\]
\[
W_{\text{out}} = \left\lfloor \frac{W_{\text{in}} + 2P_W - K_W}{S_W} \right\rfloor + 1
\]

é€šå¸¸ padding å’Œ stride åœ¨ H/W ä¸Šç›¸åŒï¼Œæ‰€ä»¥ç®€å†™ä¸ºï¼š

\[
H_{\text{out}} = \left\lfloor \frac{H_{\text{in}} + 2P - K}{S} \right\rfloor + 1
\]

---

### âš™ï¸ å››ã€å¼•å…¥ dilationï¼ˆç©ºæ´žå·ç§¯ï¼‰

ç©ºæ´žå·ç§¯åœ¨å·ç§¯æ ¸å…ƒç´ ä¹‹é—´æ’å…¥â€œç©ºæ´žâ€ï¼Œä½¿å¾—**æœ‰æ•ˆæ„Ÿå—é‡Žå˜å¤§**ã€‚

- åŽŸå§‹å·ç§¯æ ¸å¤§å°ï¼š\( K \)
- dilation rateï¼š\( D \)
- **æœ‰æ•ˆ kernel size** å˜ä¸ºï¼š
  \[
  K_{\text{eff}} = D \times (K - 1) + 1
  \]

> ä¾‹å¦‚ï¼š3Ã—3 å·ç§¯ï¼Œdilation=2 â†’ æœ‰æ•ˆ kernel = 2Ã—(3âˆ’1)+1 = 5

ä»£å…¥å‰é¢çš„å…¬å¼ï¼ŒæŠŠ \( K \) æ›¿æ¢ä¸º \( K_{\text{eff}} \)ï¼š

\[
H_{\text{out}} = \left\lfloor \frac{H_{\text{in}} + 2P - [D \cdot (K - 1) + 1]}{S} \right\rfloor + 1
\]

åŒ–ç®€ï¼š
\[
H_{\text{out}} = \left\lfloor \frac{H_{\text{in}} + 2P - D \cdot (K - 1) - 1}{S} \right\rfloor + 1
\]

âœ… è¿™å°±æ˜¯ **PyTorch å®˜æ–¹æ–‡æ¡£ä¸­çš„å®Œæ•´å…¬å¼**ï¼

---

### ðŸ“Œ äº”ã€ä¸ºä»€ä¹ˆè¦æœ‰ `-1`ï¼Ÿ

å…³é”®åœ¨äºŽï¼š**å·ç§¯æ ¸è¦†ç›–çš„æ˜¯â€œåŒºé—´â€ï¼Œè€Œä¸æ˜¯â€œç‚¹â€**ã€‚

- ä¸€ä¸ªå¤§å°ä¸º \( K \) çš„æ ¸ï¼Œå®žé™…å æ® \( K \) ä¸ªä½ç½®ï¼Œä½†å®ƒçš„â€œè·¨åº¦â€æ˜¯ \( K - 1 \)ã€‚
- ä¾‹å¦‚ï¼šæ ¸è¦†ç›– [0,1,2]ï¼ˆK=3ï¼‰ï¼Œè·¨åº¦æ˜¯ 2 = 3âˆ’1ã€‚
- æ‰€ä»¥ï¼Œåœ¨è®¡ç®—â€œè¿˜èƒ½æ»‘å¤šå°‘æ­¥â€æ—¶ï¼Œè¦å‡åŽ»çš„æ˜¯ **è·¨åº¦**ï¼Œè€Œä¸æ˜¯æ ¸å¤§å°æœ¬èº«ã€‚

è¿™å°±æ˜¯å…¬å¼ä¸­å‡ºçŽ° `-1` çš„æ ¹æœ¬åŽŸå› ã€‚

---

Same padding:

\[
H_{out} = \left\lfloor \frac{H_{in} + 2P - D(K - 1) - 1}{S} \right\rfloor + 1
\]

ä»¤ \( S = 1 \)ï¼Œ\( D = 1 \)ï¼Œå¹¶è¦æ±‚ \( H_{out} = H_{in} \)ï¼Œä»£å…¥ï¼š

\[
H_{in} = \left\lfloor \frac{H_{in} + 2P - (K - 1) - 1}{1} \right\rfloor + 1
\]

åŒ–ç®€ï¼š

\[
H_{in} = \left\lfloor H_{in} + 2P - K \right\rfloor + 1
\]

ç§»é¡¹ï¼š

\[
H_{in} - 1 = \left\lfloor H_{in} + 2P - K \right\rfloor
\]

å› ä¸ºå·¦è¾¹æ˜¯æ•´æ•°ï¼Œå³è¾¹å– floor åŽä¹Ÿå¿…é¡»æ˜¯æ•´æ•°ï¼Œæ‰€ä»¥ï¼š

\[
H_{in} - 1 = H_{in} + 2P - K
\]

è§£å‡ºï¼š

\[
2P = K - 1 \quad \Rightarrow \quad P = \frac{K - 1}{2}
\]

é€šç”¨å…¬å¼:

> \[ \boxed{P = \frac{K - 1}{2}} \]

---